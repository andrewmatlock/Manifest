<!-- Comprehensive Data Source Testing -->
<h1 class="text-2xl font-bold mb-6">Data Source Testing</h1>

<!-- Format Comparison Table -->
<table class="table-fixed w-full mb-8">
    <thead>
        <tr>
            <th class="w-1/4">Test Case / Key</th>
            <th class="w-1/4">CSV</th>
            <th class="w-1/4">JSON</th>
            <th class="w-1/4">YAML</th>
        </tr>
    </thead>
    <tbody>
        <!-- Routing Tests -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Routing Tests</td>
        </tr>
        <tr>
            <td>products.$route('path').name<br><a href="/gadget">Gadget</a> <a href="/widget">Widget</a></td>
            <td><span x-text="$x.products.$route('path').name || ''"></span></td>
            <td><span x-text="$x.json.products.$route('path').name || ''"></span></td>
            <td><span x-text="$x.yaml.products.$route('path').name || ''"></span></td>
        </tr>
        
        <!-- CSV-Specific: Multi-locale -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">CSV-Specific: Multi-locale (allLocales)</td>
        </tr>
        <tr>
            <td>allLocales.home.title</td>
            <td><span x-text="$x.allLocales.home.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.home.hero.title</td>
            <td><span x-text="$x.allLocales.home.hero.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.articles.title</td>
            <td><span x-text="$x.allLocales.articles.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.about.title</td>
            <td><span x-text="$x.allLocales.about.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.contact.title</td>
            <td><span x-text="$x.allLocales.contact.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.contact.email</td>
            <td><span x-text="$x.allLocales.contact.email || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.contact.phone</td>
            <td><span x-text="$x.allLocales.contact.phone || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.settings.theme</td>
            <td><span x-text="$x.allLocales.settings.theme || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>allLocales.settings.language</td>
            <td><span x-text="$x.allLocales.settings.language || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        
        <!-- CSV-Specific: Split locales -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">CSV-Specific: Split locales (splitLocales)</td>
        </tr>
        <tr>
            <td>splitLocales.home.title</td>
            <td><span x-text="$x.splitLocales.home.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.home.hero.title</td>
            <td><span x-text="$x.splitLocales.home.hero.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.articles.title</td>
            <td><span x-text="$x.splitLocales.articles.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.about.title</td>
            <td><span x-text="$x.splitLocales.about.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.contact.title</td>
            <td><span x-text="$x.splitLocales.contact.title || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.contact.email</td>
            <td><span x-text="$x.splitLocales.contact.email || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.contact.phone</td>
            <td><span x-text="$x.splitLocales.contact.phone || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.settings.theme</td>
            <td><span x-text="$x.splitLocales.settings.theme || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>splitLocales.settings.language</td>
            <td><span x-text="$x.splitLocales.settings.language || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        
        <!-- CSV-Specific: Flat keys -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">CSV-Specific: Flat keys (flatKeys)</td>
        </tr>
        <tr>
            <td>flatKeys.home</td>
            <td><span x-text="$x.flatKeys.home || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>flatKeys.about</td>
            <td><span x-text="$x.flatKeys.about || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>flatKeys.contact</td>
            <td><span x-text="$x.flatKeys.contact || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        <tr>
            <td>flatKeys.settings</td>
            <td><span x-text="$x.flatKeys.settings || ''"></span></td>
            <td>-</td>
            <td>-</td>
        </tr>
        
        <!-- Shared: Products array -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Shared: Products Array</td>
        </tr>
        <tr>
            <td>products (array)</td>
            <td><span x-text="JSON.stringify($x.products || [])"></span></td>
            <td><span x-text="JSON.stringify($x.json.products || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.products || [])"></span></td>
        </tr>
    </tbody>
</table>

<!-- Search & Query Testing - Isolated -->
<div class="col gap-4 p-4 border-t border-line mt-8" x-data="{ 
    searchTerm: '', 
    testResults: {},
    testMethod(method, ...args) {
        try {
            if (!$x.products) {
                this.testResults[method] = 'ERROR: $x.products is undefined';
                return;
            }
            if (typeof $x.products[method] !== 'function') {
                this.testResults[method] = 'ERROR: $x.products.' + method + ' is not a function';
                return;
            }
            const result = $x.products[method](...args);
            this.testResults[method] = 'SUCCESS: ' + JSON.stringify(result);
        } catch (e) {
            this.testResults[method] = 'ERROR: ' + e.message;
        }
    }
}">
    <h2 class="text-xl font-semibold">Search & Query Testing (Isolated)</h2>
    
    <div class="col gap-4">
        <!-- Method Existence Check -->
        <div class="p-3 border border-line rounded bg-surface-2">
            <h3 class="font-semibold mb-2">Method Existence Check</h3>
            <div class="col gap-1 text-sm">
                <div>$x.products exists: <span x-text="!!$x.products"></span></div>
                <div>$x.products.$search exists: <span x-text="typeof ($x.products && $x.products.$search)"></span></div>
                <div>$x.products.$query exists: <span x-text="typeof ($x.products && $x.products.$query)"></span></div>
                <div>$x.products.length: <span x-text="$x.products ? $x.products.length : 'N/A'"></span></div>
            </div>
        </div>
        
        <!-- Manual Test Buttons -->
        <div class="col gap-2">
            <h3 class="font-semibold">Manual Tests (Click to Test)</h3>
            <div class="row-wrap gap-2">
                <button 
                    @click="testMethod('$search', 'widget')"
                    class="px-4 py-2 bg-primary text-on-primary rounded"
                >
                    Test $search('widget')
                </button>
                <button 
                    @click="testMethod('$query', [['equal', 'category', 'Electronics']])"
                    class="px-4 py-2 bg-primary text-on-primary rounded"
                >
                    Test $query([['equal', 'category', 'Electronics']])
                </button>
                <button 
                    @click="testMethod('filter', p => p.price < 20)"
                    class="px-4 py-2 bg-surface-2 rounded"
                >
                    Test filter() (native)
                </button>
            </div>
        </div>
        
        <!-- Test Results -->
        <div class="col gap-2" x-show="Object.keys(testResults).length > 0">
            <h3 class="font-semibold">Test Results</h3>
            <div class="col gap-1">
                <template x-for="(result, method) in testResults" :key="method">
                    <div class="p-2 border border-line rounded text-sm">
                        <strong x-text="method + ':'"></strong> <span x-text="result"></span>
                    </div>
                </template>
            </div>
        </div>
        
        <!-- Simple Search Test (Only if methods exist) -->
        <div class="col gap-2" x-data="{ 
            searchTerm: '', 
            filteredProducts: [],
            updateSearch() {
                try {
                    if (!$x.products || typeof $x.products.$search !== 'function') {
                        this.filteredProducts = [];
                        return;
                    }
                    this.filteredProducts = $x.products.$search(this.searchTerm || '', 'name', 'description') || [];
                } catch (e) {
                    console.error('Search error:', e);
                    this.filteredProducts = [];
                }
            }
        }" x-init="updateSearch()" x-effect="updateSearch()">
            <h3 class="font-semibold">Simple Search Test</h3>
            <input 
                type="text" 
                placeholder="Search products by name, description..." 
                x-model="searchTerm"
                @input="updateSearch()"
                class="w-full p-2 border border-line rounded"
            />
            <div class="text-sm text-muted" x-text="'Search term: ' + (searchTerm || '(empty)')"></div>
            
            <!-- Results List -->
            <div class="col gap-2 mt-2">
                <div class="text-sm font-medium">
                    Results: <span x-text="filteredProducts.length"></span> products
                </div>
                <div class="col gap-2 max-h-96 overflow-y-auto">
                    <template x-for="product in filteredProducts" :key="product.id">
                        <div class="p-3 border border-line rounded bg-surface-2">
                            <div class="row-wrap gap-4 items-center">
                                <div class="grow">
                                    <p class="font-semibold" x-text="product.name"></p>
                                    <small class="text-muted" x-text="product.category"></small>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold" x-text="'$' + product.price"></p>
                                    <small class="text-muted" x-text="'Stock: ' + product.stock"></small>
                                </div>
                            </div>
                            <p class="text-sm mt-2" x-text="product.description"></p>
                        </div>
                    </template>
                    <div x-show="filteredProducts.length === 0" 
                         class="text-muted p-4 text-center text-sm">
                        <span x-show="!searchTerm">Type to search products...</span>
                        <span x-show="searchTerm">No products found matching "<span x-text="searchTerm"></span>"</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Comprehensive JSON/YAML Test Cases -->
<table class="table-fixed w-full mt-8">
    <thead>
        <tr>
            <th class="w-1/4">Test Case / Key</th>
            <th class="w-1/4">CSV</th>
            <th class="w-1/4">JSON</th>
            <th class="w-1/4">YAML</th>
        </tr>
    </thead>
    <tbody>
        <!-- Arrays -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Arrays</td>
        </tr>
        <tr>
            <td>arrayOfStrings</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.arrayOfStrings || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.arrayOfStrings || [])"></span></td>
        </tr>
        <tr>
            <td>arrayOfNumbers</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.arrayOfNumbers || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.arrayOfNumbers || [])"></span></td>
        </tr>
        <tr>
            <td>arrayOfBooleans</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.arrayOfBooleans || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.arrayOfBooleans || [])"></span></td>
        </tr>
        <tr>
            <td>arrayOfMixed</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.arrayOfMixed || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.arrayOfMixed || [])"></span></td>
        </tr>
        <tr>
            <td>arrayOfObjects</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.arrayOfObjects || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.arrayOfObjects || [])"></span></td>
        </tr>
        <tr>
            <td>arrayOfArrays</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.arrayOfArrays || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.arrayOfArrays || [])"></span></td>
        </tr>
        
        <!-- Primitives -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Primitives</td>
        </tr>
        <tr>
            <td>objectWithPrimitives.string</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithPrimitives.string || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithPrimitives.string || ''"></span></td>
        </tr>
        <tr>
            <td>objectWithPrimitives.number</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithPrimitives.number || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithPrimitives.number || ''"></span></td>
        </tr>
        <tr>
            <td>objectWithPrimitives.boolean</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithPrimitives.boolean || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithPrimitives.boolean || ''"></span></td>
        </tr>
        <tr>
            <td>objectWithPrimitives.null</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithPrimitives.null || 'null'"></span></td>
            <td><span x-text="$x.yaml.objectWithPrimitives.null || 'null'"></span></td>
        </tr>
        
        <!-- Objects with Arrays -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Objects with Arrays</td>
        </tr>
        <tr>
            <td>objectWithArrays.strings</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.objectWithArrays.strings || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.objectWithArrays.strings || [])"></span></td>
        </tr>
        <tr>
            <td>objectWithArrays.numbers</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.objectWithArrays.numbers || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.objectWithArrays.numbers || [])"></span></td>
        </tr>
        <tr>
            <td>objectWithArrays.mixed</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.objectWithArrays.mixed || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.objectWithArrays.mixed || [])"></span></td>
        </tr>
        
        <!-- Nested Objects -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Nested Objects</td>
        </tr>
        <tr>
            <td>objectWithObjects.nested.level</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithObjects.nested.level || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithObjects.nested.level || ''"></span></td>
        </tr>
        <tr>
            <td>objectWithObjects.nested.value</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithObjects.nested.value || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithObjects.nested.value || ''"></span></td>
        </tr>
        <tr>
            <td>objectWithObjects.another.deep.level</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithObjects.another.deep.level || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithObjects.another.deep.level || ''"></span></td>
        </tr>
        <tr>
            <td>objectWithObjects.another.deep.data</td>
            <td>-</td>
            <td><span x-text="$x.json.objectWithObjects.another.deep.data || ''"></span></td>
            <td><span x-text="$x.yaml.objectWithObjects.another.deep.data || ''"></span></td>
        </tr>
        
        <!-- Complex Nested -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Complex Nested Structures</td>
        </tr>
        <tr>
            <td>complexNested.users</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.complexNested.users || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.complexNested.users || [])"></span></td>
        </tr>
        <tr>
            <td>complexNested.metadata.count</td>
            <td>-</td>
            <td><span x-text="$x.json.complexNested.metadata.count || ''"></span></td>
            <td><span x-text="$x.yaml.complexNested.metadata.count || ''"></span></td>
        </tr>
        <tr>
            <td>complexNested.metadata.lastUpdated</td>
            <td>-</td>
            <td><span x-text="$x.json.complexNested.metadata.lastUpdated || ''"></span></td>
            <td><span x-text="$x.yaml.complexNested.metadata.lastUpdated || ''"></span></td>
        </tr>
        <tr>
            <td>complexNested.metadata.features</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.complexNested.metadata.features || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.complexNested.metadata.features || [])"></span></td>
        </tr>
        
        <!-- Empty Arrays -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Empty Arrays</td>
        </tr>
        <tr>
            <td>emptyArrays.emptyStringArray.length</td>
            <td>-</td>
            <td><span x-text="$x.json.emptyArrays.emptyStringArray.length || 0"></span></td>
            <td><span x-text="$x.yaml.emptyArrays.emptyStringArray.length || 0"></span></td>
        </tr>
        <tr>
            <td>emptyArrays.emptyObjectArray.length</td>
            <td>-</td>
            <td><span x-text="$x.json.emptyArrays.emptyObjectArray.length || 0"></span></td>
            <td><span x-text="$x.yaml.emptyArrays.emptyObjectArray.length || 0"></span></td>
        </tr>
        <tr>
            <td>emptyArrays.emptyNested.empty.length</td>
            <td>-</td>
            <td><span x-text="$x.json.emptyArrays.emptyNested.empty.length || 0"></span></td>
            <td><span x-text="$x.yaml.emptyArrays.emptyNested.empty.length || 0"></span></td>
        </tr>
        
        <!-- Empty Objects -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Empty Objects</td>
        </tr>
        <tr>
            <td>emptyObjects.empty (keys count)</td>
            <td>-</td>
            <td><span x-text="Object.keys($x.json.emptyObjects.empty || {}).length"></span></td>
            <td><span x-text="Object.keys($x.yaml.emptyObjects.empty || {}).length"></span></td>
        </tr>
        <tr>
            <td>emptyObjects.nestedEmpty.empty (keys count)</td>
            <td>-</td>
            <td><span x-text="Object.keys($x.json.emptyObjects.nestedEmpty.empty || {}).length"></span></td>
            <td><span x-text="Object.keys($x.yaml.emptyObjects.nestedEmpty.empty || {}).length"></span></td>
        </tr>
        
        <!-- Mixed Structures -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">Mixed Structures</td>
        </tr>
        <tr>
            <td>mixedStructure.topLevelString</td>
            <td>-</td>
            <td><span x-text="$x.json.mixedStructure.topLevelString || ''"></span></td>
            <td><span x-text="$x.yaml.mixedStructure.topLevelString || ''"></span></td>
        </tr>
        <tr>
            <td>mixedStructure.topLevelNumber</td>
            <td>-</td>
            <td><span x-text="$x.json.mixedStructure.topLevelNumber || ''"></span></td>
            <td><span x-text="$x.yaml.mixedStructure.topLevelNumber || ''"></span></td>
        </tr>
        <tr>
            <td>mixedStructure.arrayOfMixedObjects</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.mixedStructure.arrayOfMixedObjects || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.mixedStructure.arrayOfMixedObjects || [])"></span></td>
        </tr>
        <tr>
            <td>mixedStructure.objectWithMixedArrays.primitives</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.mixedStructure.objectWithMixedArrays.primitives || [])"></span>
            </td>
            <td><span x-text="JSON.stringify($x.yaml.mixedStructure.objectWithMixedArrays.primitives || [])"></span>
            </td>
        </tr>
        <tr>
            <td>mixedStructure.objectWithMixedArrays.objects</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.mixedStructure.objectWithMixedArrays.objects || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.mixedStructure.objectWithMixedArrays.objects || [])"></span></td>
        </tr>
        <tr>
            <td>mixedStructure.objectWithMixedArrays.arrays</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.json.mixedStructure.objectWithMixedArrays.arrays || [])"></span></td>
            <td><span x-text="JSON.stringify($x.yaml.mixedStructure.objectWithMixedArrays.arrays || [])"></span></td>
        </tr>

        <!-- YAML-Specific: Top-level array -->
        <tr class="bg-surface-1">
            <td colspan="4" class="font-semibold p-2">YAML-Specific: Top-level Array</td>
        </tr>
        <tr>
            <td>yamlArray (top-level array)</td>
            <td>-</td>
            <td>-</td>
            <td><span x-text="JSON.stringify($x.yamlArray || [])"></span></td>
        </tr>
    </tbody>
</table>
