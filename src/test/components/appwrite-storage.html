<h2>Storage</h2>

<!-- Assets Bucket Files -->
<div class="col gap-4">

    <div class="row justify-between items-center gap-4">

        <!-- Status -->
        <div>
            <small x-show="window.$x.assets.$loading" class="text-muted text-sm">Loading files...</small>
            <small x-show="window.$x.assets.$error" class="text-error text-sm" x-text="window.$x.assets.$error"></small>
            <small
                x-show="window.$x.assets.$ready && !window.$x.assets.$loading && !window.$x.assets.$error && window.$x.assets.length === 0">No
                files in the assets bucket.</small>
            <small x-show="window.$x.assets.$ready && !window.$x.assets.$loading && !window.$x.assets.$error"
                class="text-success text-sm">Files
                loaded: <b x-text="window.$x.assets.length"></b></small>
        </div>

        <!-- Upload File -->
        <label role="button" class="sm w-fit">
            <input type="file"
                @change="if ($event.target.files.length > 0) { window.$x.assets.$create($event.target.files[0]).then(() => { $event.target.value = ''; }).catch(err => { console.error('[Upload] Upload failed:', err); alert('Upload failed: ' + (err.message || err)); }); }"
                accept="*/*" />
            <i x-icon="lucide:upload"></i>
        </label>

    </div>

    <!-- Files List -->
    <div x-show="window.$x.assets.length > 0" class="col gap-2">
        <template x-for="(file, index) in window.$x.assets" :key="file.$id || index">
            <div class="row gap-2 items-center w-full p-2 bg-surface-2">

                <!-- Preview Thumbnail (for images) -->
                <div x-show="file.$isImage" class="flex-shrink-0">
                    <img x-show="file.$thumbnailUrl" :src="file.$thumbnailUrl" :alt="file.name || 'Preview'"
                        class="w-16 h-16 object-cover rounded" @error="$el.style.display = 'none'" loading="lazy" />
                    <div x-show="file.$thumbnailError"
                        class="w-16 h-16 bg-surface-3 rounded flex items-center justify-center" title="Thumbnail error">
                        <small class="text-xs text-muted">Error</small>
                    </div>
                    <div x-show="file.$thumbnailLoading"
                        class="w-16 h-16 bg-surface-3 rounded flex items-center justify-center">
                        <small class="text-xs text-muted">Loading...</small>
                    </div>
                </div>

                <!-- File Info -->
                <div class="col gap-1 flex-1 min-w-0">
                    <figcaption class="truncate font-semibold" x-text="file.name || 'Unnamed file'"></figcaption>
                    <div class="row-wrap gap-2 text-sm text-muted">
                        <small>ID: <code class="text-xs" x-text="file.$id"></code></small>
                        <small x-show="file.$formattedSize">
                            Size: <span x-text="file.$formattedSize"></span>
                        </small>
                        <small x-show="file.mimeType">
                            Type: <span x-text="file.mimeType"></span>
                        </small>
                        <small x-show="file.$formattedDate">
                            Created: <span x-text="file.$formattedDate"></span>
                        </small>
                    </div>
                </div>

                <!-- Actions -->
                <div class="row gap-1 ms-auto">
                    <!-- Preview (for images) -->
                    <button class="sm" x-show="file.$isImage"
                        @click="window.$x.assets.$openPreview(file.$id, { width: 800, height: 800 })"
                        x-icon="lucide:eye" title="Preview">
                        Preview
                    </button>

                    <!-- View URL -->
                    <button class="sm" @click="window.$x.assets.$openUrl(file.$id)" x-icon="lucide:external-link"
                        title="View URL">
                        View
                    </button>

                    <!-- Download -->
                    <button class="sm" @click="window.$x.assets.$openDownload(file.$id, file.name)"
                        x-icon="lucide:download" title="Download">
                        Download
                    </button>

                    <!-- Duplicate -->
                    <button class="sm"
                        @click="window.$x.assets.$duplicate(file.$id).then(result => { console.log('File duplicated:', result); }).catch(err => { console.error('Duplicate error:', err); alert('Failed to duplicate file: ' + (err.message || err)); })"
                        x-icon="lucide:copy" title="Duplicate file">
                        Duplicate
                    </button>

                    <!-- Delete -->
                    <button class="sm"
                        @click="if (confirm('Delete ' + (file.name || 'this file') + '?')) { window.$x.assets.$delete(file.$id); }"
                        x-icon="lucide:trash" title="Delete file">
                        Delete
                    </button>
                </div>
            </div>
        </template>
    </div>

</div>